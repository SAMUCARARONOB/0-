local TweenService = game:GetService("TweenService")

local function CreateWindow(config)
    local ScreenGui = Instance.new("ScreenGui", game.CoreGui)
    ScreenGui.Name = config.Name or "CustomHub"
    ScreenGui.ResetOnSpawn = false

    local Window = Instance.new("Frame", ScreenGui)
    Window.Size = UDim2.new(0, 500, 0, 350)
    Window.Position = UDim2.new(0.5, -250, 0.5, -175)
    Window.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    Window.BorderSizePixel = 0
    Window.AnchorPoint = Vector2.new(0.5, 0.5)
    Window.Active = true
    Window.Draggable = true
    Window.ClipsDescendants = true

    local TitleBar = Instance.new("Frame", Window)
    TitleBar.Size = UDim2.new(1, 0, 0, 36)
    TitleBar.BackgroundColor3 = Color3.fromRGB(25, 25, 30)
    TitleBar.BorderSizePixel = 0

    local TitleLabel = Instance.new("TextLabel", TitleBar)
    TitleLabel.Text = config.Title or "CUSTOM HUB"
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 18
    TitleLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Size = UDim2.new(1, -90, 1, 0)
    TitleLabel.Position = UDim2.new(0, 10, 0, 0)
    TitleLabel.TextXAlignment = Enum.TextXAlignment.Left

    local BtnClose = Instance.new("TextButton", TitleBar)
    BtnClose.Size = UDim2.new(0, 30, 0, 25)
    BtnClose.Position = UDim2.new(1, -35, 0, 5)
    BtnClose.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    BtnClose.Text = "✕"
    BtnClose.TextColor3 = Color3.fromRGB(255, 80, 80)
    BtnClose.Font = Enum.Font.GothamBold
    BtnClose.TextSize = 18
    BtnClose.BorderSizePixel = 0
    BtnClose.AutoButtonColor = false

    local BtnMin = Instance.new("TextButton", TitleBar)
    BtnMin.Size = UDim2.new(0, 30, 0, 25)
    BtnMin.Position = UDim2.new(1, -70, 0, 5)
    BtnMin.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    BtnMin.Text = "—"
    BtnMin.TextColor3 = Color3.fromRGB(200, 200, 200)
    BtnMin.Font = Enum.Font.GothamBold
    BtnMin.TextSize = 18
    BtnMin.BorderSizePixel = 0
    BtnMin.AutoButtonColor = false

    local TabBar = Instance.new("Frame", Window)
    TabBar.Size = UDim2.new(1, 0, 0, 30)
    TabBar.Position = UDim2.new(0, 0, 0, 36)
    TabBar.BackgroundTransparency = 1

    local UIListTabs = Instance.new("UIListLayout", TabBar)
    UIListTabs.FillDirection = Enum.FillDirection.Horizontal
    UIListTabs.SortOrder = Enum.SortOrder.LayoutOrder
    UIListTabs.Padding = UDim.new(0, 2)

    local TabsFrame = Instance.new("Frame", Window)
    TabsFrame.Size = UDim2.new(1, 0, 1, -66)
    TabsFrame.Position = UDim2.new(0, 0, 0, 66)
    TabsFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    TabsFrame.BorderSizePixel = 0
    TabsFrame.ClipsDescendants = true

    local TabContents = {}
    local CurrentTab

    local function Switch(tabName, marker)
        for name, data in pairs(TabContents) do
            data.Frame.Visible = (name == tabName)
            data.Marker.Visible = (name == tabName)
        end
        CurrentTab = tabName
    end

    local function CreateTab(name)
        local btn = Instance.new("TextButton", TabBar)
        btn.Text = name
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 14
        btn.TextColor3 = Color3.fromRGB(240, 240, 240)
        btn.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
        btn.Size = UDim2.new(0, 100, 1, 0)
        btn.BorderSizePixel = 0

        local marker = Instance.new("Frame", btn)
        marker.Size = UDim2.new(1, 0, 0, 2)
        marker.Position = UDim2.new(0, 0, 1, -2)
        marker.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        marker.Visible = false

        local content = Instance.new("ScrollingFrame", TabsFrame)
        content.Size = UDim2.new(1, 0, 1, 0)
        content.BackgroundTransparency = 1
        content.BorderSizePixel = 0
        content.Visible = false
        content.CanvasSize = UDim2.new(0, 0, 0, 0)
        content.AutomaticCanvasSize = Enum.AutomaticSize.Y
        local layout = Instance.new("UIListLayout", content)
        layout.Padding = UDim.new(0, 8)
        layout.SortOrder = Enum.SortOrder.LayoutOrder

        TabContents[name] = {
            Frame = content,
            Marker = marker,
        }

        btn.MouseButton1Click:Connect(function()
            Switch(name)
        end)

        if not CurrentTab then
            marker.Visible = true
            content.Visible = true
            CurrentTab = name
        end

        return content
    end

    BtnMin.MouseButton1Click:Connect(function()
        local visible = TabsFrame.Visible
        if visible then
            TabsFrame.Visible = false
            Window:TweenSize(UDim2.new(0, 500, 0, 66), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.3, true)
        else
            Window:TweenSize(UDim2.new(0, 500, 0, 350), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.3, true)
            task.delay(0.3, function() TabsFrame.Visible = true end)
        end
    end)

    BtnClose.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
    end)

    local function CreateToggle(parent, cfg)
        local f = Instance.new("Frame", parent)
        f.Size = UDim2.new(1, -20, 0, 40)
        f.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        f.BorderSizePixel = 0
        Instance.new("UICorner", f).CornerRadius = UDim.new(0, 6)

        local lbl = Instance.new("TextLabel", f)
        lbl.Text = cfg.Text or "Toggle"
        lbl.Font = Enum.Font.Gotham
        lbl.TextSize = 14
        lbl.TextColor3 = Color3.fromRGB(255, 255, 255)
        lbl.BackgroundTransparency = 1
        lbl.Size = UDim2.new(1, -60, 1, 0)
        lbl.Position = UDim2.new(0, 10, 0, 0)
        lbl.TextXAlignment = Enum.TextXAlignment.Left
        lbl.TextYAlignment = Enum.TextYAlignment.Center

        local sw = Instance.new("Frame", f)
        sw.Size = UDim2.new(0, 40, 0, 22)
        sw.Position = UDim2.new(1, -50, 0.5, -11)
        sw.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        sw.BorderSizePixel = 0
        Instance.new("UICorner", sw).CornerRadius = UDim.new(1, 0)

        local ball = Instance.new("Frame", sw)
        ball.Size = UDim2.new(0, 16, 0, 16)
        ball.Position = UDim2.new(0, 2, 0.5, -8)
        ball.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
        ball.BorderSizePixel = 0
        Instance.new("UICorner", ball).CornerRadius = UDim.new(1, 0)

        local btn = Instance.new("TextButton", sw)
        btn.Size = UDim2.new(1, 0, 1, 0)
        btn.BackgroundTransparency = 1

        local on = false
        btn.MouseButton1Click:Connect(function()
            on = not on
            TweenService:Create(sw, TweenInfo.new(0.2), {BackgroundColor3 = on and Color3.fromRGB(170, 0, 0) or Color3.fromRGB(40,40,40)}):Play()
            TweenService:Create(ball, TweenInfo.new(0.2), {
                Position = on and UDim2.new(1,-18,0.5,-8) or UDim2.new(0,2,0.5,-8),
                BackgroundColor3 = on and Color3.fromRGB(255,255,255) or Color3.fromRGB(200,200,200)
            }):Play()
            if cfg.Callback then cfg.Callback(on) end
        end)
    end

    return {
        CreateTab = CreateTab,
        CreateToggle = CreateToggle,
    }
end

return CreateWindow
